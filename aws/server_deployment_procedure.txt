
1. Create an ECR Repository:
   - Go to the Amazon ECR console
   - Click "Create repository"
   - Name your repository (e.g., "fastapi-app")
   - Note the repository URI

2. Install and Configure AWS CLI:
   Make sure you have the AWS CLI installed and configured with the necessary permissions.

3. Build and Push Your Docker Image to ECR:
   ```bash
   # Retrieve an authentication token and authenticate your Docker client to your registry
   aws ecr get-login-password --region your-region | docker login --username AWS --password-stdin your-account-id.dkr.ecr.your-region.amazonaws.com

   # Build your Docker image
   docker build -t fastapi-app .

   # Tag your image
   docker tag fastapi-app:latest your-account-id.dkr.ecr.your-region.amazonaws.com/fastapi-app:latest

   # Push the image to ECR
   docker push your-account-id.dkr.ecr.your-region.amazonaws.com/fastapi-app:latest
   ```

4. Launch an EC2 Instance:
   - Go to the EC2 dashboard in AWS Console
   - Click "Launch Instance"
   - Choose Amazon Linux 2 AMI
   - Select an instance type (e.g., t2.micro for free tier)
   - Configure instance details, add storage, and configure security group
   - Open ports 22 (SSH), 80 (HTTP), and 443 (HTTPS)
   - Create or select a key pair

5. Connect to Your EC2 Instance:
   ```bash
   ssh -i /path/to/your-key.pem ec2-user@your-instance-public-dns
   ```

6. Install Docker on EC2:
   ```bash
   sudo yum update -y
   sudo amazon-linux-extras install docker
   sudo service docker start
   sudo usermod -a -G docker ec2-user
   ```
   Log out and log back in for the group changes to take effect.

7. Configure EC2 to Pull from ECR:
   - Attach an IAM role to your EC2 instance with permissions to pull from ECR, or
   - Configure AWS credentials on the EC2 instance

8. Pull and Run Your Docker Image:
   ```bash
   # Login to ECR
   aws ecr get-login-password --region your-region | docker login --username AWS --password-stdin your-account-id.dkr.ecr.your-region.amazonaws.com

   # Pull the image
   docker pull your-account-id.dkr.ecr.your-region.amazonaws.com/fastapi-app:latest

   # Run the container
   docker run -d -p 8000:8000 --name fastapi-container your-account-id.dkr.ecr.your-region.amazonaws.com/fastapi-app:latest
   ```

9. Install and Configure Nginx:
   ```bash
   sudo amazon-linux-extras install nginx1
   sudo nano /etc/nginx/conf.d/fastapi_app.conf
   ```
   Add the following configuration:
   ```nginx
   server {
       listen 80;
       server_name your_domain.com;
       
       location / {
           proxy_pass http://127.0.0.1:8000;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
       }
   }
   ```
   Start Nginx:
   ```bash
   sudo systemctl start nginx
   sudo systemctl enable nginx
   ```

10. Set Up SSL with Certbot (Optional but Recommended):
    ```bash
    sudo amazon-linux-extras install epel
    sudo yum install certbot python2-certbot-nginx
    sudo certbot --nginx -d your_domain.com
    ```

11. Update Your Frontend:
    Update your React application to use the new EC2 public DNS or domain name for API calls.

12. Deploy Your Frontend:
    Use AWS Amplify to deploy your React frontend as described in previous responses.

13. (Optional) Set Up Auto-restart:
    Create a systemd service file to ensure your container starts on boot:
    ```bash
    sudo nano /etc/systemd/system/fastapi-container.service
    ```
    Add the following content:
    ```ini
    [Unit]
    Description=FastAPI Container
    Requires=docker.service
    After=docker.service

    [Service]
    Restart=always
    ExecStart=/usr/bin/docker start -a fastapi-container
    ExecStop=/usr/bin/docker stop -t 2 fastapi-container

    [Install]
    WantedBy=multi-user.target
    ```
    Enable and start the service:
    ```bash
    sudo systemctl enable fastapi-container.service
    sudo systemctl start fastapi-container.service
    ```

This setup gives you a robust deployment pipeline:
1. Your Docker image is stored securely in ECR
2. The FastAPI backend runs in a container on EC2
3. Your React frontend is hosted on AWS Amplify

Remember to update your CORS settings in your FastAPI app to allow requests from your Amplify domain. Also, set up the API_URL in your React app (via Amplify environment variables) to point to your EC2 instance's public DNS or domain name.

This approach combines the benefits of containerization, a managed container registry (ECR), flexible compute (EC2), and seamless frontend hosting (Amplify).